# Tests Module

This directory contains automated tests for the BC PIBot Streamlit application. It uses `pytest` and `streamlit.testing` (AppTest) to simulate user interactions and verify application behavior.

## Structure

*   **`test_app.py`**: The main test suite.
    *   `test_app_startup`: A simple smoke test to ensure the app loads without errors.
    *   `test_single_interaction`: Verifies a basic "Hello" interaction.
    *   `test_batch_questions_from_excel`: Reads questions from an Excel file, runs them against the app, and logs the responses.
*   **`data_loader.py`**: Utility module to handle loading questions from Excel files. It supports files with a "Question" header or headerless files (using the first column).
*   **`output/`**: Directory where the results of the batch tests are saved as Excel files.
*   **`input/test_preguntas.xlsx`**: The input file containing the questions to be tested.

## Prerequisites

Ensure your virtual environment is active and dependencies are installed. You will need `pytest`, `pandas`, and `openpyxl` (usually included in the project `requirements.txt`).

## Input Data

The batch test looks for a file named `tests/input/test_preguntas.xlsx`.
*   **Format**: Excel (.xlsx)
*   **Columns**: It expects a column named `Question`. If that column is missing, it will default to using the first column of the sheet.

## Running the Tests

To run all tests:
```bash
pytest tests/test_app.py
```

To run **only the batch Excel test** and see the progress output:
```bash
pytest tests/test_app.py -k "excel" -s
```
*   `-k "excel"`: Selects tests matching the string "excel".
*   `-s`: Allows stdout (print statements) to be shown in the console, which is useful for tracking progress.

## Test Results

The `test_batch_questions_from_excel` test generates a detailed report for every run.
*   **Location**: `tests/output/test_results_YYYYMMDD_HHMMSS.xlsx`
*   **Columns**:
    *   `SessionID`: Unique UUID for the test session.
    *   `Question`: The input question.
    *   `Answer`: The response generated by the bot.
    *   `Status`: `Success`, `App Error`, `No Response`, etc.
    *   `Error`: Detailed error message if the status is not Success.
    *   `Timestamp`: Time of execution.

## Troubleshooting

*   **File Not Found**: Ensure `tests/test_preguntas.xlsx` exists.
*   **Dependencies**: If you get import errors, run `pip install -r requirements.txt`.
